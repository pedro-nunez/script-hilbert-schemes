\documentclass[12pt,a4paper]{amsart}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[british]{babel}
\usepackage{mathtools}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{mathrsfs}
\usepackage{enumitem}
\usepackage{tikz-cd}
\usetikzlibrary{decorations.markings}
\usepackage{float}
\usepackage{hyperref}
\urlstyle{same}
\usepackage[noabbrev]{cleveref}

\theoremstyle{plain}
\newtheorem{thm}{Theorem}[section]
\newtheorem*{thm*}{Theorem}
\newtheorem{lm}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}
\newtheorem{exmp}[thm]{Example}
\newtheorem{xca}[thm]{Exercise}
\theoremstyle{remark}
\newtheorem{rem}[thm]{Remark}
\Crefname{thm}{Theorem}{Theorems}
\Crefname{lm}{Lemma}{Lemmas}
\Crefname{prop}{Proposition}{Propositions}
\Crefname{cor}{Corollary}{Corollaries}
\Crefname{defn}{Definition}{Definitions}
\Crefname{exmp}{Example}{Examples}
\Crefname{xca}{Exercise}{Exercises}
\Crefname{rem}{Remark}{Remarks}

\title[Talk on Hilbert schemes of points on surfaces]{Talk on Hilbert schemes of points on surfaces}
\author[Pedro N\'{u}\~{n}ez]{Pedro N\'{u}\~{n}ez}
\address{Pedro N\'{u}\~{n}ez \newline
\indent Albert-Ludwigs-Universit\"{a}t Freiburg, Mathematisches Institut \newline
\indent Ernst-Zermelo-Stra√üe 1, 79104 Freiburg im Breisgau (Germany)}
\email{\normalfont\href{mailto:pedro.nunez@math.uni-freiburg.de}{pedro.nunez@math.uni-freiburg.de}}
\renewcommand*{\urladdrname}{\itshape Homepage}
\urladdr{\normalfont\href{https://home.mathematik.uni-freiburg.de/nunez/}{https://home.mathematik.uni-freiburg.de/nunez}}
\thanks{The author gratefully acknowledges support by the DFG-Graduiertenkolleg GK1821 ``Cohomological Methods in Geometry'' at the University of Freiburg.}
\date{\today}

\setcounter{tocdepth}{1}
\sloppy
\makeatletter
\hypersetup{
  pdfauthor={\authors},
  pdftitle={\@title},
  colorlinks,
  linkcolor=[rgb]{0.2,0.2,0.6},
  citecolor=[rgb]{0.2,0.6,0.2},
  urlcolor=[rgb]{0.6,0.2,0.2}}
\makeatother

\begin{document}

\maketitle

\begin{abstract}
  Script for the 7\textsuperscript{th} talk of the seminar on Heisenberg algebras and Hilbert schemes of points on surfaces organized by Mara Ungureanu during the Summer Term 2021 at the University of Freiburg.
\end{abstract}

\tableofcontents

\begin{center}
  \textcolor{gray}{---parts in gray will be omitted during the talk---}
\end{center}

\setcounter{section}{-1}

\section{Conventions and notation}

We always work over $\mathbb{C}$.
By a variety we mean an integral separated scheme of finite type over $\mathbb{C}$.

\appendix

\section{Quotients of quasi-projective varieties by finite groups}

We will mostly follow the notes in \url{http://www.math.lsa.umich.edu/~mmustata/appendix.pdf} in this appendix.

\begin{rem}
  Let $G$ be a finite group and let $X = \operatorname{Spec}{A}$ be an affine variety.
  An action of $G$ on $A$ by $\mathbb{C}$-algebra automorphisms \textit{from the left} is the same as an aciton of $G$ on $X$ by $\mathbb{C}$-scheme morphisms \textit{from the right}.
  The two things are more explicitly related as follows:
  \[ (g \cdot f)(x) = f(x \cdot g). \]
\end{rem}

There are various notions of quotients in algebraic geometry, cf.~\cite[\S 0.1]{mfk94}.
Fortunately, in the case of finite groups, the various notions agree.

\begin{defn}
  Let $G$ be a finite group and let $X$ be a scheme of finite type over $\mathbb{C}$.
  Let $\sigma \colon X \times G \to X$ be an action of $G$ on $X$ on the right\footnote{So that $G$ acts on coordinate rings on the left.}.
  A \textit{quotient of $X$ by $G$} is a $\mathbb{C}$-scheme $Y$ together with a $\mathbb{C}$-scheme morphism $\pi \colon X \to Y$ with the following properties:
  \begin{enumerate}[label=\roman*)]
    \item $\pi$ is $G$-invariant, i.e.~we have $\pi \circ \sigma = \pi \circ p_{1}$, where $p_{1} \colon X \times G \to X$ is the projection.
    \item $\pi$ is universal with respect to the property in $i)$, i.e.~for every $\mathbb{C}$-scheme $Z$ and every $G$-invariant $\mathbb{C}$-scheme morphism $f \colon X \to Z$, there exists a unique $\mathbb{C}$-scheme morphism $h \colon Y \to Z$ such that $h \circ \pi = f$.
  \end{enumerate}
\end{defn}

\begin{rem}
  The previous definition is that of a \textit{categorical quotient}, cf.~\cite[Definition 0.5]{mfk94}.
\end{rem}

\begin{rem}
  (Categorical) quotients are unique up to unique isomorphism, meaning that given any other pair $(Y', \pi')$ with the same properties, there exists a unique $\mathbb{C}$-scheme isomorphism $\varphi \colon Y' \to Y$ such that $\pi' = \varphi \circ \pi$.
\end{rem}

\begin{lm}\label{lm:finitetype}
  Let $G$ be a finite group.
  Let $A$ be a finite type $\mathbb{C}$-algebra and assume that the group $G$ acts on $A$ from the left by $\mathbb{C}$-algebra automorphisms.
  Then the set of invariant elements $A^{G}$ is a $\mathbb{C}$-subalgebra of $A$ which is of finite type over $\mathbb{C}$.

  \begin{proof}
    Let $\rho \colon G \to \operatorname{Aut}_{\mathbb{C}}(A)$ be the given left action.
    Let us first quickly ensure that
    \[ A^{G} := \bigcap_{g \in G} \{ a \in A \mid \rho(g)(a) = a \} \]
    is a $\mathbb{C}$-subalgebra of $A$.
    \begin{itemize}
      \item $A^{G} \subseteq A$ is a subgroup.
        Indeed, since $\rho(g)$ is a ring morphism for every $g \in G$, we have $0 \in A^{G}$.
        And if $a_{1}, a_{2} \in A^{G}$ and $g \in G$, then it follows again from $\rho(g)$ being a ring morphism that
        \[ \rho(g)(a_{1}+a_{2}) = \rho(g)(a_{1}) + \rho(g)(a_{2}) = a_{1} + a_{2}. \]
      \item $A^{G} \subseteq A$ is a subring.
        We have seen already that it is a subgroup.
        Since $\rho(g)$ is a ring morphism for every $g \in G$, we also have $1 \in A^{G}$, so it remains only to show that $A^{G}$ is closed under products.
        If $a_{1}, a_{2} \in A^{G}$ and $g \in G$, then using once again that $\rho(g)$ is a ring morphism we see that
        \[ \rho(g)(a_{1}a_{2}) = \rho(g)(a_{1})\rho(g)(a_{2}) = a_{1}a_{2}. \]
      \item $A^{G} \subseteq A$ is a $\mathbb{C}$-vector subspace.
        We have seen already that it is a subgroup, so it remains only to show that $A^{G}$ is closed under scalar product.
        If $a \in A^{G}$, $\lambda \in \mathbb{C}$ and $g \in G$, then we use the assumption that $\rho(g)$ is $\mathbb{C}$-linear to deduce that
        \[ \rho(g)(\lambda a) = \lambda \rho(g)(a) = \lambda a. \]
    \end{itemize}
    
    The other assertion in the lemma is that $A^{G}$ is a finite type $\mathbb{C}$-algebra.
    The idea is to write $A^{G}$ as a finite $B$-module for some suitable finite type $\mathbb{C}$-algebra $B$.
    Then it would follow that $A^{G}$ is a finite type $\mathbb{C}$-algebra as well.
    Indeed, let $\beta_{1}, \ldots, \beta_{m} \in B$ be generators of $B$ as an algebra over $\mathbb{C}$, and let $e_{1}, \ldots, e_{l} \in A^{G}$ be generators of $A^{G}$ as a $B$-module.
    Then we can write any $a \in A^{G}$ as a $B$-linear combination
    \[ a = \sum_{i = 1}^{l} b_{i}e_{i}, \]
    and in turn each $b_{i}$ as an algebraic combination
    \[ b_{i} = f_{i}(\beta_{1}, \ldots, \beta_{m}) \]
    for some $f_{i} \in \mathbb{C}[\beta_{1}, \ldots, \beta_{m}]$.
    It follows that we can write $a$ as an algebraic combination in the variables $\beta_{1}, \ldots, \beta_{m}, e_{1}, \ldots, e_{l}$, so these elements would form a system of generators of $A^{G}$ as a $\mathbb{C}$-algebra.

    In order to construct such $B$, we first note that the inclusion $A^{G} \subseteq A$ is an integral ring extension.
    Indeed, every $a \in A$ is a root of the monic polynomial
    \[ P_{a}(t) := \prod_{g \in G}(t - \rho(g)(a)), \]
    whose coefficients are in $A^{G}$ by Vieta's formulas.
    Let $\alpha_{1}, \ldots, \alpha_{m} \in A$ be generators of $A$ as an algebra over $\mathbb{C}$.
    Let $\{ c_{i,j} \}_{j = 0}^{d_{i}}$ be the coefficients of $P_{\alpha_{i}}$ for each $i \in \{1, \ldots, m\}$.
    Then define $B$ to be the $\mathbb{C}$-subalgebra of $A$ generated by all these coefficients $\{ c_{1,0}, \ldots, c_{1,d_{1}}, c_{2,0}, \ldots, c_{m,d_{m}} \}$.
    Since each of its generators is contained in $A^{G}$, we see that $B$ is also a $\mathbb{C}$-subalgebra of $A^{G}$.
    Moreover, by construction $B \subseteq A$ is an integral ring extension.
    The elements $\alpha_{1}, \ldots, \alpha_{m}$ still generate $A$ as a $B$-algebra, so $A$ is a finitely generated $B$-module \cite[Corollary 5.2]{am69}.
    But $B$ is noetherian, because it is a finitely generated $\mathbb{C}$-algebra, so every $B$-submodule of $A$ must also be finitely generated as a $B$-module.
    Therefore $A^{G}$ is a finitely generated $B$-module, which as explained earlier concludes the proof.
  \end{proof}

\end{lm}

\begin{lm}\label{lm:finitesurjective}
  In the situation of \Cref{lm:finitetype}, the induced $\mathbb{C}$-scheme morphism $\pi \colon \operatorname{Spec}(A) \to \operatorname{Spec}(A^{G})$ is finite and surjective.

  \begin{proof}
    It follows from the proof of \Cref{lm:finitetype} that $A$ is finitely generated as an $A^{G}$-module, so the induced morphism $\pi$ is finite by definition \cite[p.~84]{har77}.
    Surjectivity follows from \cite[\href{https://stacks.math.columbia.edu/tag/00GQ}{Tag 00GQ}]{stacks-project}.
  \end{proof}
\end{lm}

\begin{rem}\label{rem:irreducible}
  It follows from \Cref{lm:finitesurjective} that $\operatorname{Spec}(A^{G})$ is irreducible if $\operatorname{Spec}(A)$ was irreducible.
  But the converse is not true, e.g.~consider $\mathbb{Z}/2\mathbb{Z}$ acting non-trivially on two points.
\end{rem}

\begin{lm}\label{lm:fibers}
  In the situation of \Cref{lm:finitetype}, the fibers of $\pi$ over closed points of $Y$ are precisely the orbits of the closed points of $X$ under the action of $G$.
  In particular, $\pi$ is $G$-invariant.

  \begin{proof}
    Let $x \in X$ be a closed point.
    Let us check first that the orbit $x \cdot G$ is contained in the fiber $\pi^{-1}(\pi(x))$.
    Let $\mathfrak{m} \subseteq A$ be the maximal ideal corresponding to $x$, i.e.
    \[ \mathfrak{m} = \{ f \in A \mid f(x) = 0 \}. \]
    Let $g \in G$.
    Our goal is to show that $\pi(x) = \pi(x \cdot g)$.
    The maximal ideal corresponding to the point $x \cdot g$ is given by
    \[ \{ f \in A \mid f(x \cdot g) = 0 \} = \{ f \in A \mid (g \cdot f)(x) = 0 \} = \{ g\cdot f \mid f \in \mathfrak{m} \} = g \cdot \mathfrak{m}. \]
    So we need to show that
    \[ \mathfrak{m} \cap A^{G} = (g \cdot \mathfrak{m}) \cap A^{G}. \]
    But we have
    \begin{align*}
      (g \cdot \mathfrak{m}) \cap A^{G} & = \{ (g \cdot f) \in A^{G} \mid f \in \mathfrak{m} \} \\
      & = \{ g^{-1} \cdot (g \cdot f) \in A^{G} \mid f \in \mathfrak{m} \} \\
      & = \{ f \in A^{G} \mid f \in \mathfrak{m} \} \\
      & = \mathfrak{m} \cap A^{G}. 
    \end{align*}
    Hence $x \cdot G \subseteq \pi^{-1}(\pi(x))$.

    Conversely, let $x_{1}, x_{2} \in \pi^{-1}(\pi(x_{1}))$ be closed points with corresponding maximal ideals $\mathfrak{m}_{1}$ and $\mathfrak{m}_{2}$ respectively.
    The assumption that $x_{1}$ and $x_{2}$ are in the same fiber translates into the equality
    \[ \mathfrak{m}_{1} \cap A^{G} = \mathfrak{m}_{2} \cap A^{G}. \]
    We use this equality to show that
    \[ \mathfrak{m}_{1} \subseteq \bigcup_{g \in G} (g \cdot \mathfrak{m}_{2}). \]
    Indeed, given any $f \in \mathfrak{m}_{1}$, we can produce a $G$-invariant element in the maximal ideal by looking at the (finite) product
    \[ \prod_{g \in G} (g \cdot f) \in \mathfrak{m}_{1} \cap A^{G} = \mathfrak{m}_{2} \cap A^{G} \subseteq \mathfrak{m}_{2}. \]
    Since $\mathfrak{m}_{2}$ is a prime ideal, there exists some $g \in G$ such that $g \cdot f \in \mathfrak{m}_{2}$.
    Hence $\mathfrak{m}_{1} \subseteq \cup_{g \in G} (g \cdot \mathfrak{m}_{2})$ as claimed.
    Since $G$ acts by ring morphisms, each ideal $g \cdot \mathfrak{m}_{2}$ is again a prime ideal.
    So we may apply the prime avoidance lemma to conclude that there exists some $g_{1} \in G$ such that $\mathfrak{m}_{1} \subseteq g_{1} \cdot \mathfrak{m}_{2}$.
    By symmetry of $x_{1}$ and $x_{2}$ there exists some $g_{2} \in G$ such that $\mathfrak{m}_{2} \subseteq g_{2} \cdot \mathfrak{m}_{1}$.
    So
    \[ \mathfrak{m}_{1} \subseteq g_{1} \cdot \mathfrak{m}_{2} \subseteq g_{1} g_{2} \cdot \mathfrak{m}_{1}. \]
    Since $G$ acts by ring automorphisms, $\mathfrak{m}_{1}$ and $g_{1} g_{2} \cdot \mathfrak{m}_{1}$ are prime ideals of the same height.
    Therefore $\mathfrak{m}_{1} = g_{1} g_{2} \cdot \mathfrak{m}_{1}$.
    From this we finally deduce that
    \[ g_{1} \cdot \mathfrak{m}_{2} \subseteq g_{1}g_{2} \cdot \mathfrak{m}_{1} = \mathfrak{m}_{1} \subseteq g_{1} \cdot \mathfrak{m}_{2}, \]
    so that $\mathfrak{m}_{1} = g_{1} \cdot \mathfrak{m}_{2}$ and $x_{1} \in x_{2} \cdot G$.
  \end{proof}
\end{lm}

\begin{lm}\label{lm:topology}
  In the situation of \Cref{lm:finitetype}, the topology on $\operatorname{Spec}(A^{G})$ is the quotient topology induced by $\pi$.
  
  \begin{proof}
    We need to show that a subset $U \subseteq \operatorname{Spec}(A^{G})$ is open as soon as $\pi^{-1}(U)$ is open.
    So let $U \subseteq \operatorname{Spec}(A^{G})$ be a subset such that $\pi^{-1}(U)$ is open in $\operatorname{Spec}(A)$.
    Let $Z := \operatorname{Spec}(A^{G}) \setminus U$.
    Then $\pi^{-1}(Z) = \operatorname{Spec}(A) \setminus \pi^{-1}(U)$, which by assumption is a closed subset in $\operatorname{Spec}(A)$.
    By \Cref{lm:finitesurjective} the morphism $\pi$ is surjective, so $Z \subseteq \pi(\pi^{-1}(Z))$.
    And $\pi(\pi^{-1}(Z)) \subseteq Z$ is always true, so we deduce that $\pi(\pi^{-1}(Z)) = Z$.
    But again from \Cref{lm:finitesurjective} we know that $\pi$ is a finite morphism, in particular a proper morphism of schemes and hence a closed morphism of topological spaces.
    So $Z$ is a closed subset and $U$ is open, as we wanted to show.
  \end{proof}
\end{lm}

\begin{lm}\label{lm:invariantslocalization}
  In the situation of \Cref{lm:finitetype}, let us denote $X = \operatorname{Spec}(A)$ and $Y = \operatorname{Spec}(A^{G})$.
  Then $\mathscr{O}_{Y}$ is the subsheaf of $\pi_{*}\mathscr{O}_{X}$ consisting of invariant functions, i.e.~if $f \in \Gamma(V,\pi_{*}\mathscr{O}_{X}) = \Gamma(\pi^{-1}(V),\mathscr{O}_{X})$, then $f \in \Gamma(V, \mathscr{O}_{Y})$ if and only if the following diagram commutes:
  
  \begin{center}
    \begin{tikzcd}
      \pi^{-1}(V) \times G \arrow{r}{\sigma} \arrow{d}{p_{1}} & \pi^{-1}(V) \arrow{d}{f} \\
      \pi^{-1}(V) \arrow{r}{f} & \mathbb{A}^{1}.
    \end{tikzcd}
  \end{center}

  \begin{proof}
    This follows from the definition of the structure sheaf on the spectrum of a ring combined with the compatibility of localization with taking subrings of invariants \cite[Exercise 5.12]{am69}.
  \end{proof}

\end{lm}

\begin{cor}\label{cor:quotient}
  In the situation of \Cref{lm:finitetype}, the induced morphism $\pi \colon \operatorname{Spec}(A) \to \operatorname{Spec}(A^{G})$ is a (categorical) quotient of $\operatorname{Spec}(A)$ by $G$.
  Moreover, it is also a \textit{geometric quotient} in the sense of \cite[Definition 0.6]{mfk94}.

  \begin{proof}
    We check first that $\pi$ is a geometric quotient.
    There are four items in \cite[Definition 0.6]{mfk94}:
    \begin{enumerate}[label=\roman*)]
      \item $G$-invariance follows from \Cref{lm:fibers}.
      \item Surjectivity follows from \Cref{lm:finitesurjective}, and the fibers over closed points being precisely the orbits of closed points follows from \Cref{lm:fibers}.
      \item We have seen that $\operatorname{Spec}(A^{G})$ carries the quotient topology induced by $\pi$ in \Cref{lm:topology}.
      \item That the structure sheaf of $\operatorname{Spec}(A^{G})$ agrees with the subsheaf of $G$-invariant functions of $\pi_{*}\mathscr{O}_{\operatorname{Spec}(A)}$ was checked in \Cref{lm:invariantslocalization}.
    \end{enumerate}
    So $\pi$ is indeed a geometric quotient.
    
    We check next that it is also a categorical quotient following \cite[Porposition 0.1]{mfk94}, as in fact any geometric quotient is.
    But first, some notation.
    Let us call $X = \operatorname{Spec}(A)$, $Y = \operatorname{Spec}(A^{G})$ and $\Gamma = \Gamma(G, \mathscr{O}_{G})$.
    Denote by $\sigma \colon X \times G \to X$ the group action and by $\tau \colon A \to A \otimes_{\mathbb{C}} \Gamma$ the induced morphism on coordinate rings.
    Finally, let us also denote simply by $\rho \colon A \to A \otimes_{\mathbb{C}} \Gamma$ the morphism induced on coordinate rings by the projection $X \times G \to X$.

    In order to prove the claim, we start by showing that the universal property holds in the affine case.
    Assume then that we have some $G$-invariant $\mathbb{C}$-scheme morphism $\nu \colon X \to Z$ such that $Z = \operatorname{Spec}(B)$ and $\nu$ is induced by a $\mathbb{C}$-algebra homomorphism $v \colon B \to A$.
    Recall that $G$-invariance means that $\nu(x \cdot g) = \nu(x)$ for all $x \in X$ and all $g \in G$, i.e.~that the following diagram of $\mathbb{C}$-schemes commutes:

    \begin{center}
      \begin{tikzcd}
        X \times G \arrow{r}{\sigma} \arrow{d}{p_{1}} & X \arrow{d}{\nu} \\
        X \arrow{r}{\nu} & Z
      \end{tikzcd}
    \end{center}

    Equivalently, the following diagram of $\mathbb{C}$-algebras commutes:

    \begin{center}
      \begin{tikzcd}
        A \otimes_{\mathbb{C}} \Gamma & A \arrow{l}{\tau} \\
        A \arrow{u}{\rho} & B \arrow{l}{v} \arrow{u}{v}
      \end{tikzcd}
    \end{center}

    We claim that $G$-invariance of $\nu$ translates into the image of $v$ being contained in $A^{G}$.
    Indeed, let $f \colon Z \to \mathbb{A}^{1}$ be a regular function on $Z$, i.e.~an element of its coordinate ring $B$; and let $g \in G$.
    We want to show that $g \cdot v(f) = v(f)$.
    To check the equality between these two functions it suffices two check that they agree on all closed points of $X$, so let also $x \in X$ be a closed point.
    We have
    \begin{align*}
      (g \cdot v(f))(x) & = v(f)(x \cdot g) \\
      & = v(f)(\sigma(x, g)) \\
      & = \tau(v(f))(x,g) \\
      & = \rho(v(f))(x,g) \\
      & = v(f)(x),
    \end{align*}
    hence our claim.
    
    But now, since the image of $v \colon B \to A$ is contained in $A^{G} \subseteq A$, there exists a unique $\mathbb{C}$-algebra homomorphism $\bar{v} \colon B \to A^{G}$ such that $v$ is the composition of $\bar{v}$ and the inclusion $A^{G}$.
    Denoting by $\bar{\nu} \colon Y \to Z$ the corresponding $\mathbb{C}$-scheme morphism, this translates into saying that $\bar{\nu} \colon Y \to Z$ is the unique $\mathbb{C}$-scheme morphism such that $\bar{\nu} \circ \pi = \nu$.
    So the desired universal property holds for affine schemes.

    Let now $Z$ be any $\mathbb{C}$-scheme together with a $G$-invariant morhpism $\nu \colon X \to Z$.
    Let $\{ W_{i} \}_{i \in I}$ be an affine open cover of $Z$, and let $\nu_{i} \colon \nu^{-1}(W_{i}) \to W_{i}$ denote the corestriction of $\nu$ to $W_{i}$ for each $i \in I$.
    $G$-invariance of $\nu$ implies that $\nu^{-1}(W_{i}) \subseteq X$ is $G$-invariant, so expressing it as the union of the orbits of its elements we see that it is possible to find some subset $V_{i} \subseteq Y$ such that $\nu^{-1}(W_{i}) = \pi^{-1}(V_{i})$.
    Since $\nu^{-1}(W_{i})$ is open, so is $\pi^{-1}(V_{i})$ and thus so is $V_{i}$, because $Y$ carries the quotient topology induced by $\pi$.
    Let $\{ V_{i,j} \}_{j \in J_{i}}$ be an affine open cover of $V_{i}$ for each $i \in I$.
    All the properties in the definition of a geometric quotient are local on the target, so each corestriction $\pi_{i,j} \colon \pi^{-1}(V_{i,j}) \to V_{i,j}$ is a geometric quotient.
    Moreover, since being finite is also local on the target, each $\pi_{i,j}$ is also finite, and since $V_{i,j}$ is affine we deduce that $U_{i,j} := \pi^{-1}(V_{i,j})$ is affine as well for each $i \in I$ and each $j \in J_{i}$.
    The last condition in the definition of geometric quotient ensures that $\pi_{i,j}$ still has the form $\operatorname{Spec}(R_{i,j}) \to \operatorname{Spec}(R_{i,j}^{G})$.
    So we are really back in the affine case that we treated before, and therefore there exists a ``unique'' factorization as desired.
    Uniqueness in this case is restricted to the world of affine schemes.
    Luckily $Y$ is an affine scheme, so it is separated and the intersection of affine open subsets is again affine.
    So the different factorizations $V_{i,j} \to W_{i}$ that we obtain agree on the affine overlaps of the various $V_{i,j}$'s, and hence they glue to a uniquely determined factorization $V_{i} \to W_{i}$ for each $i \in I$.
    If $Y$ wasn't separated we could still check that the different morphisms that we obtain in this manner agree on the overlaps by covering the intersections of the $V_{i,j}$'s further with affine opens.
    But we'd be running out of indices already, so let us thank separatedness for sparing us the hassle.
    Okay, but it seems that now there isn't any way around it: the $V_{i}$'s are not affine themselves, so to check that the obtained factorizations $V_{i} \to W_{i}$ glue, it seems that we would still need to cover the intersections of different $V_{i}$'s by affine opens.
    In any case, after a finite amount of gluing processes, this yields the desired uniquely determined factorization $Y \to Z$.
  \end{proof}

\end{cor}

\begin{rem}
  In an attempt of making the proof simpler by checking the universal property for affine schemes first we ended up making it much worse.
  Hats off to \cite{mfk94} for their much better proof, using \cite[Exercise II.2.4]{har77} instead of the cumbersome reduction to the entirely affine case.
\end{rem}

\bibliographystyle{alpha}
\bibliography{main}
\vfill

\end{document}
